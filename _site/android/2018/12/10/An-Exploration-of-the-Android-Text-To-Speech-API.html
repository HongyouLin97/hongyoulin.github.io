<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Favicon Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.jpg">

    <title>An Exploration of the Android Text To Speech API</title>
    <meta name="description"
          content="A practical attempt to understand the powerful Text To Speech of Android.">

    <link rel="canonical" href="http://localhost:4000/android/2018/12/10/An-Exploration-of-the-Android-Text-To-Speech-API.html">
    <link rel="alternate" type="application/rss+xml" title="Welcome :)" href="http://localhost:4000/feed.xml">

    <script type="text/javascript" src="/bower_components/jquery/dist/jquery.min.js"></script>

    <!-- Third-Party CSS -->
    <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/bower_components/octicons/octicons/octicons.css">
    <link rel="stylesheet" href="/bower_components/hover/css/hover-min.css">
    <link rel="stylesheet" href="/bower_components/primer-markdown/dist/user-content.min.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- My CSS -->
    <link rel="stylesheet" href="/assets/css/common.css">

    <!-- CSS set in page -->
    

    <!-- CSS set in layout -->
    
    <link rel="stylesheet" href="/assets/css/sidebar-post-nav.css">
    

    <script type="text/javascript" src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    
    
</head>


    <body>

    <header class="site-header">
    <div class="container">
        <a id="site-header-brand" href="/" title="Hongyou Lin">
            <span class="octicon octicon-mortar-board"></span> Hongyou Lin
        </a>
        <nav class="site-header-nav" role="navigation">
            
            <a href="/"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="Home">
                Home
            </a>
            
            <a href="/projects"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="Projects">
                Projects
            </a>
            
            <a href="/blog"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="Blog">
                Blog
            </a>
            
            <a href="/useful_links"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="Useful Links">
                Useful Links
            </a>
            
            <a href="/about"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="About">
                About
            </a>
            
        </nav>
    </div>
</header>


        <div class="content">
            <section class="jumbotron geopattern" data-pattern-id="An Exploration of the Android Text To Speech API">
    <div class="container">
        <div id="jumbotron-meta-info">
            <h1>An Exploration of the Android Text To Speech API</h1>
            <span class="meta-info">
                
                
                <span class="octicon octicon-calendar"></span> 2018/12/10
                
            </span>
        </div>
    </div>
</section>
<script>
    $(document).ready(function(){

        $('.geopattern').each(function(){
            $(this).geopattern($(this).data('pattern-id'));
        });

    });
</script>
<script src="//yihui.org/js/math-code.js"></script>
<!-- Just one possible MathJax CDN below. You may use others. -->
<script async
  src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<article class="post container" itemscope itemtype="http://schema.org/BlogPosting">
    <div class="row">
        
        
        <div class="col-md-8 markdown-body">

            <p>A practical attempt to understand the powerful Text To Speech of Android.</p>

<h2 id="introduction">Introduction</h2>
<p>Right now all the android phones have the ability to speak out the texts of a screen via a generated voice. How does Android convert the texts into the speech then? Android Text To Speech is the answer. It is one of the powerful Android features that can allow users to convert plain text into speech that is synthesized by the Android TTS engine. It has a variety of usages, and its main purpose is to give users the ability to hear the texts spoken out loud in their android phones without the need to look at them. It enables users to do other things while listening to the contents of an app. It also helps illiterate users or users with disability to understand the texts in an app without difficulty.</p>

<p>Text To Speech was initially introduced in Android 1.6 API 4 in 2009, and it gradually becomes mature as the Android programmers invest their times in improving the feature. Right now, all Android platforms that has an API level bigger than API 4 can support the TTS feature. In order to really understand the Android Text To Speech feature, we need to first explore a few aspects of Android TTS engine that is important to the TTS-enabled application, and then understand how to incorporate the TTS feature into our application and configure the TTS engine correctly to make our application speak by showing a TTS-enabled example app.</p>

<p>A workflow diagram like below is also helpful for understanding how to incorporate the TTS feature into an app:</p>
<p><img src="/assets/images/text-to-speech-workflow.jpeg" alt="TTS workflow diagram" width="400" height="930" /> </p>
<p>I will explain all parts of the TTS workflow diagram section by section from <code class="highlighter-rouge">Start</code> to <code class="highlighter-rouge">End</code> and also implement the example app according to this workflow diagram.</p>

<h2 id="tts-engine">TTS Engine</h2>
<p>The TTS engine is an android framework that provides the android app the ability to perform speech synthesis that converts the texts inside the app into a spoken voice output. It is included in the Android platform, and it supports a large number of languages such as Chinese, English, French, Italian, Japanese, Russian, and Spanish, etc.. It also supports a variety of dialects from the same language (e.g. British English, American English, Canadian French, etc.) because the same language can be spoken differently in different regions of the world.</p>

<p>In order to make the TTS engine work correctly in an app, we have to first initialize a TextToSpeech instance in that app’s activity via its constructor that takes the application’s context and TextToSpeech.OnInitListener. The TextToSpeech.OnInitListener must be configured because we need to define the behaviors of the TextToSpeech engine so that it can correctly speak the texts according to our needs. Here is an example for what an initialization of TextToSpeech instance in a MainActivity looks like:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>
   <span class="n">TextToSpeech</span> <span class="n">mTextToSpeech</span><span class="o">;</span>

   <span class="nd">@Override</span>
   <span class="kd">protected</span> <span class="kt">void</span> <span class="n">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
       <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
       <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
       <span class="c1">// initialization of TextToSpeech Instance</span>
       <span class="n">mTextToSpeech</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextToSpeech</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="k">new</span> <span class="n">TextToSpeech</span><span class="o">.</span><span class="na">OnInitListener</span><span class="o">()</span> <span class="o">{</span>
           <span class="nd">@Override</span>
           <span class="kd">public</span> <span class="kt">void</span> <span class="n">onInit</span><span class="o">(</span><span class="kt">int</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
               <span class="c1">// if initialization is successful, define the behaviors of the TextToSpeech engine</span>
               <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">==</span> <span class="n">TextToSpeech</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">)</span> <span class="o">{</span>
                   <span class="c1">// set the language to be American English</span>
                   <span class="n">Locale</span> <span class="n">language</span> <span class="o">=</span> <span class="n">Locale</span><span class="o">.</span><span class="na">US</span><span class="o">;</span>
                   <span class="kt">int</span> <span class="n">isSupported</span> <span class="o">=</span> <span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">setLanguage</span><span class="o">(</span><span class="n">language</span><span class="o">);</span>
                   <span class="k">if</span> <span class="o">(</span><span class="n">isSupported</span> <span class="o">!=</span> <span class="n">TextToSpeech</span><span class="o">.</span><span class="na">LANG_AVAILABLE</span> <span class="o">&amp;&amp;</span> <span class="n">isSupported</span> <span class="o">!=</span> <span class="n">TextToSpeech</span><span class="o">.</span><span class="na">LANG_COUNTRY_AVAILABLE</span><span class="o">)</span> <span class="o">{</span>
                       <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span><span class="s">"The current language "</span> <span class="o">+</span> <span class="n">language</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span> <span class="s">" is not available."</span><span class="o">,</span>
                               <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                   <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                       <span class="c1">// it is supported</span>
                       <span class="kt">int</span> <span class="n">statusForPitch</span> <span class="o">=</span> <span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">setPitch</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span> <span class="c1">// set the pitch to be normal</span>
                       <span class="kt">int</span> <span class="n">statusForRate</span> <span class="o">=</span> <span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">setSpeechRate</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span> <span class="c1">// set the speech rate to 2</span>
                       <span class="k">if</span> <span class="o">(</span><span class="n">statusForPitch</span> <span class="o">!=</span> <span class="n">TextToSpeech</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">)</span> <span class="o">{</span>
                           <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="s">"Fail to set pitch"</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                       <span class="o">}</span>
                       <span class="k">if</span> <span class="o">(</span><span class="n">statusForRate</span> <span class="o">!=</span> <span class="n">TextToSpeech</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">)</span> <span class="o">{</span>
                           <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="s">"Fail to set the Speech rate"</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                       <span class="o">}</span>
                   <span class="o">}</span>
               <span class="o">}</span>
           <span class="o">}</span>
       <span class="o">});</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>In the above example, we first check the status of the initialization of the TextToSpeech instance. If it is successful, we move on to define the behaviors of this instance. We first set the language via <code class="highlighter-rouge">mTextToSpeech.setLanguage(language)</code> to load and set language, in the country <code class="highlighter-rouge">US</code>, to our TextToSpeech engine. That method takes Locale object (i.e. <code class="highlighter-rouge">Locale.US</code>) as a parameter and return an integer (e.g. <code class="highlighter-rouge">TextToSpeech.LANG_AVAILABLE</code>, <code class="highlighter-rouge">LANG_COUNTRY_AVAILABLE</code>, and <code class="highlighter-rouge">LANG_NOT_SUPPORTED</code>, etc.) to indicate the status of the chosen Locale. We can also set the pitch of the speech for the engine via <code class="highlighter-rouge">mTextToSpeech.setPitch(2)</code> and its speech rate via <code class="highlighter-rouge">mTextToSpeech.setSpeechRate(2)</code>, which both take a float as input and return either <code class="highlighter-rouge">TextToSpeech.SUCCESS</code> or <code class="highlighter-rouge">ERROR</code> for status checking. The setPitch method’s default pitch value is 1, which is normal pitch. The higher value of the input increases the pitch, whereas the low value lowers it. The setSpeechRate method works like the setPitch method except that it sets the speech rate. These two methods essentially allow us to determine the synthesized speech’s tone and speed.</p>

<p>Alternatively, we can choose which TTS engine to be used in the app by call <code class="highlighter-rouge">TextToSpeech.setEngineByPacakgeName(String enginePackageName)</code>. If the given engine exists, the TextToSpeech instance will use that engine. Otherwise, by default it uses the default TTS engine provided by the phone device.</p>

<h2 id="language-and-locale">Language and Locale</h2>
<p>Note that in the above example code for MainActivity class, we mention about the Locale object that is the input parameter of the TextToSpeech.setLanguage() method. This Locale object is provided by android operating system, and it essentially tells the TextToSpeech engine which language to load. If we look into the Locale object, we can see that it supports various accents of the same languages (e.g. Canada French, France French, etc.). We can use Locale.getAvailableLocales() to get the variety of the same language in different regions of the world (e.g. new Locale(“en”).getAvailableLocales()).  We can also check if a particular language is supported by an android device through TextToSpeech.isLanguageAvailable(Locale), and that method will return back a support status code for the given Locale to notify us about its availability. For example, the calls:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">isLanguageAvailable</span><span class="o">(</span><span class="n">Locale</span><span class="o">.</span><span class="na">US</span><span class="o">);</span>
<span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">isLanguageAvailable</span><span class="o">(</span><span class="n">Locale</span><span class="o">.</span><span class="na">UK</span><span class="o">);</span>
</code></pre>
</div>

<p>will return TextToSpeech.LANG_COUNTRY_AVAILABLE to indicate that both the language and the country are available.</p>

<p>While setting up the language for the engine, we have to make sure that the text’s language is a match for the engine so that we don’t make funny speech that is hard to understand.</p>

<h2 id="speak-out-loud">Speak out loud!</h2>
<p>Once we successfully initialize the TextToSpeech instance, configure the engine correctly, and define its behaviors we can move on to actually make the app take in a string input to synthesize the speech and speak it out loud. To do all these, we will use the <code class="highlighter-rouge">TextToSpeech.speak(CharSequence text, int queueMode, HashMap&lt;String, String&gt; params)</code> to speak the text we want. Let’s look at the following codes:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">speak</span><span class="o">(</span><span class="s">"Text To Speech is cool!"</span><span class="o">,</span> <span class="n">TextToSpeech</span><span class="o">.</span><span class="na">QUEUE_FLUSH</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span>
<span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">speak</span><span class="o">(</span><span class="s">"Text To Speech is not hard to understand."</span><span class="o">,</span> <span class="n">TextToSpeech</span><span class="o">.</span><span class="na">QUEUE_ADD</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span>
<span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">speak</span><span class="o">(</span><span class="s">"Text To Speech is easy."</span><span class="o">,</span> <span class="n">TextToSpeech</span><span class="o">.</span><span class="na">QUEUE_ADD</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span>
</code></pre>
</div>

<p>We see that some constants about Queue is mentioned in the code. It is because the TTS engine maintains a global queue for all the text entries to synthesize, which are also called “utterances”. Since each instance of TextToSpeech has its own queue, we need to flush the queue so that it can control which text entry can interrupt the current one and which one is queued. Hence, the first <code class="highlighter-rouge">speak()</code> flushes the queue and speaks its text entry, and the second and third <code class="highlighter-rouge">speak()</code> calls add their text entries into the queue in a first-in-first-out manner and speak them in order defined by the queue after the first <code class="highlighter-rouge">speak()</code> call is finished.</p>

<p>Note that the <code class="highlighter-rouge">speak()</code> is asynchronous, which means all the <code class="highlighter-rouge">speak()</code> calls are already finished before all the speeches from the queue have been synthesized and spoken out loud, regardless of the use of QUEUE_ADD or QUEUE_FLUSH. The optional params in the <code class="highlighter-rouge">speak()</code> method provides a way to perform other tasks after a <code class="highlighter-rouge">speak()</code> call is finished, and it can be set to null if we just don’t want to do anything after the <code class="highlighter-rouge">speak()</code> call is finished. We can also implement UtteranceProgressListener to define what to do before starting (i.e. <code class="highlighter-rouge">OnStart()</code>), what to do after finishing speaking (i.e. <code class="highlighter-rouge">OnDone()</code>), and what to do when there is an error (i.e. <code class="highlighter-rouge">OnError()</code>). The implementation of UtteranceProgressListener is not necessary for the <code class="highlighter-rouge">speak()</code> to work properly.</p>

<h2 id="audio-file-and-playback">Audio file and playback</h2>
<p>While the <code class="highlighter-rouge">speak()</code> method of TextToSpeech synthesizes and speaks the input text right away, we may want to store the synthesized speech as an audio files because we may choose to speak the same text repeatedly in our app. If we choose to use <code class="highlighter-rouge">speak()</code> to speak the same text all the time, the overhead burden for CPU to process the speech synthesis will increase unnecessarily and a lot of resources (e.g. memory, computation time, etc.) are wasted in the repeated <code class="highlighter-rouge">speak()</code> calls for the same text. To avoid this issue, we can use the <code class="highlighter-rouge">TextToSpeech.synthesizeToFile(String text, HashMap&lt;String, String&gt; params, String filename)</code> to synthesize the speech for the given text and store it into an .wav audio file. The example codes are the following:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">String</span> <span class="n">speechText</span> <span class="o">=</span> <span class="s">"Text To Speech synthesize to file."</span>
<span class="n">String</span> <span class="n">audioFilePathName</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStoragePublicDirectory</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">DIRECTORY_DOCUMENTS</span><span class="o">).</span><span class="na">getPath</span><span class="o">()</span> <span class="o">+</span> <span class="s">"audio.wav"</span>
<span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">synthesizeToFile</span><span class="o">(</span><span class="n">speechText</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">audioFilePathName</span><span class="o">)</span>
</code></pre>
</div>

<p>As we can see in the above codes, we use <code class="highlighter-rouge">synthesizeToFile()</code> to synthesize the speechText and store it as audio.wav file under the directory of Documents. Note that we have to edit the AndroidManifest.xml to give the app permissions for writing the audio file into the file storage of the android phone. We just need to add the following into the AndroidManifest.xml:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.READ_EXTERNAL_STORAGE"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.WRITE_EXTERNAL_STORAGE"</span> <span class="nt">/&gt;</span>
</code></pre>
</div>

<p>Alternatively, we can use <code class="highlighter-rouge">synthesizeToFile(CharSequence text, Bundle params, File file, String utteranceId)</code> which does the same job as the previous method. The only difference is the parameters of these two methods.</p>

<p>If we know there is an existed audio file that corresponds to a given text in the device, we can use <code class="highlighter-rouge">TextToSpeech.addSpeech(CharSequence text, File file)</code> such that the corresponding audio file can be played when the <code class="highlighter-rouge">speak()</code> method is called with that particular text:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">File</span> <span class="n">audioFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">audioFilePathName</span><span class="o">)</span>
<span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">addSpeech</span><span class="o">(</span><span class="n">speechText</span><span class="o">,</span> <span class="n">audioFilePathName</span><span class="o">)</span>
<span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">speak</span><span class="o">(</span><span class="n">speechText</span><span class="o">,</span> <span class="n">TextToSpeech</span><span class="o">.</span><span class="na">QUEUE_ADD</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">addSpeech()</code> method associates the given text string with the audio file. If that audio file doesn’t exist, the <code class="highlighter-rouge">speak()</code> will just synthesize the speech for the text and speak it.</p>

<h2 id="at-the-end-of-using-texttospeech">At the end of using TextToSpeech</h2>
<p>When we are done using TextToSpeech, we should call <code class="highlighter-rouge">TextToSpeech.shutdown()</code> inside the activity’s <code class="highlighter-rouge">OnDestroy()</code> to release all the resources used by its instance so that the TextToSpeech engine can be cleanly stopped and the previous resources held by it can be used by other apps.</p>

<h2 id="example-app">Example App</h2>
<p>To demonstrate the usage of the Android TTS feature, I have implemented a simple TTS-enabled example app that can allow user to enter the text and click the button to make the app speak out the text in different language. The main page of the app is shown below:</p>
<p><img src="/assets/images/TTSExampleAppScreenShot.png" alt="TTS Example app screenshot" width="300" height="451" /></p>
<p>As we can see, this example app allows user to choose among Chinese, English, French, and Spanish through checking the corresponding radio buttons. Choosing different language will make the app speak the same text differently because the TTS engine is set to that chosen language via TextToSpeech.setLanguage(Locale) each time we select different radio button for the language.</p>
<p><img src="/assets/images/TTSExampleAppScreenShot2.png" alt="TTS Example app screenshot2" width="300" height="451" /></p>
<p>(Speak “Hi” in robotic-sound English)</p>

<p><img src="/assets/images/TTSExampleAppscreenShot3.png" alt="TTS Example app screenshot3" width="300" height="451" /></p>
<p>(Speak “Bonjour” in robotic-sound French)</p>

<p>The codes and the xml template that accomplish the switching of the languages for the app are shown below:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">RadioGroup</span> <span class="n">radioGroup</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">radioGroup</span><span class="o">);</span>
<span class="n">radioGroup</span><span class="o">.</span><span class="na">clearCheck</span><span class="o">();</span>
<span class="n">radioGroup</span><span class="o">.</span><span class="na">setOnCheckedChangeListener</span><span class="o">(</span><span class="k">new</span> <span class="n">RadioGroup</span><span class="o">.</span><span class="na">OnCheckedChangeListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onCheckedChanged</span><span class="o">(</span><span class="n">RadioGroup</span> <span class="n">group</span><span class="o">,</span> <span class="kt">int</span> <span class="n">checkedId</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">RadioButton</span> <span class="n">languageRadioButton</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">checkedId</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">languageRadioButton</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">switch</span> <span class="o">(</span><span class="n">languageRadioButton</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">case</span> <span class="s">"English"</span><span class="o">:</span>
                    <span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">setLanguage</span><span class="o">(</span><span class="n">Locale</span><span class="o">.</span><span class="na">US</span><span class="o">);</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">"French"</span><span class="o">:</span>
                    <span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">setLanguage</span><span class="o">(</span><span class="n">Locale</span><span class="o">.</span><span class="na">FRANCE</span><span class="o">);</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">"Chinese"</span><span class="o">:</span>
                    <span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">setLanguage</span><span class="o">(</span><span class="n">Locale</span><span class="o">.</span><span class="na">CHINESE</span><span class="o">);</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">"Spanish"</span><span class="o">:</span>
                    <span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">setLanguage</span><span class="o">(</span><span class="k">new</span> <span class="n">Locale</span><span class="o">(</span><span class="s">"es"</span><span class="o">));</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">default</span><span class="o">:</span>
                    <span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">setLanguage</span><span class="o">(</span><span class="n">Locale</span><span class="o">.</span><span class="na">US</span><span class="o">);</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">isSameLanguage</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
</div>

<p>activity_main.xml</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    <span class="nt">&lt;RadioGroup</span>
        <span class="na">android:id=</span><span class="s">"@+id/radioGroup"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintHorizontal_bias=</span><span class="s">"0.029"</span>
        <span class="na">app:layout_constraintLeft_toLeftOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintRight_toRightOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintVertical_bias=</span><span class="s">"0.217"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;RadioButton</span>
            <span class="na">android:id=</span><span class="s">"@+id/chinese_radiobutton"</span>
            <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_weight=</span><span class="s">"1"</span>
            <span class="na">android:text=</span><span class="s">"@string/chinese"</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;RadioButton</span>
            <span class="na">android:id=</span><span class="s">"@+id/english_radiobutton"</span>
            <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_weight=</span><span class="s">"1"</span>
            <span class="na">android:text=</span><span class="s">"@string/english"</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;RadioButton</span>
            <span class="na">android:id=</span><span class="s">"@+id/french_radiobutton"</span>
            <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_weight=</span><span class="s">"1"</span>
            <span class="na">android:text=</span><span class="s">"@string/french"</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;RadioButton</span>
            <span class="na">android:id=</span><span class="s">"@+id/spanish_radiobutton"</span>
            <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_weight=</span><span class="s">"1"</span>
            <span class="na">android:text=</span><span class="s">"@string/spanish"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/RadioGroup&gt;</span>
</code></pre>
</div>

<p>What is not shown in the main page of the app is that each time the app speaks a text, it will first check if the audio file for that text exists or not in the phone. If not, the app will synthesize the speech and store it into an audio file for later usage so that we don’t waste CPU resource. If the audio file for that text exists in the phone, the app will associate the corresponding text with the audio file and play it. The codes that do this job is shown below:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>        <span class="n">EditText</span> <span class="n">editText</span><span class="o">;</span>
        <span class="o">...</span>
        <span class="n">audioFolderPath</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStoragePublicDirectory</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">DIRECTORY_MUSIC</span><span class="o">).</span><span class="na">getPath</span><span class="o">();</span>
        <span class="o">...</span>
        <span class="n">editText</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editText</span><span class="o">);</span>
        <span class="n">Button</span> <span class="n">speechButton</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button</span><span class="o">);</span>
        <span class="n">speechButton</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">textForSpeech</span> <span class="o">=</span> <span class="n">editText</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">audioFileName</span> <span class="o">=</span> <span class="n">textForSpeech</span><span class="o">+</span><span class="s">".mp3"</span><span class="o">;</span>
                <span class="n">String</span> <span class="n">audioFileCompletePath</span> <span class="o">=</span> <span class="n">audioFolderPath</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">audioFileName</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"[^a-zA-Z0-9\\.\\-]"</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
                <span class="n">File</span> <span class="n">audioFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">audioFileCompletePath</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">audioFile</span><span class="o">.</span><span class="na">exists</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">isSameLanguage</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">addSpeech</span><span class="o">(</span><span class="n">textForSpeech</span><span class="o">,</span> <span class="n">audioFileCompletePath</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="mi">21</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">synthesizeToFile</span><span class="o">(</span><span class="n">textForSpeech</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">audioFile</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">synthesizeToFile</span><span class="o">(</span><span class="n">textForSpeech</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">audioFileCompletePath</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="n">isSameLanguage</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">textForSpeech</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                <span class="n">mTextToSpeech</span><span class="o">.</span><span class="na">speak</span><span class="o">(</span><span class="n">textForSpeech</span><span class="o">,</span> <span class="n">TextToSpeech</span><span class="o">.</span><span class="na">QUEUE_ADD</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
</code></pre>
</div>

<p>Notice that we have to check the build version of the device because we are using different <code class="highlighter-rouge">TextToSpeech.synthesizeToFile()</code> method for different build version due to deprecation. With these code, the app will get the text from <code class="highlighter-rouge">EditText</code> view and check if there is associated audio file. If there is, we associate the given text with the audio file via <code class="highlighter-rouge">mTextToSpeech.addSpeech(textForSpeech, audioFileCompletePath)</code>. If not, the app synthesizes the speech and stores it as .mp3 file under the Music folders. At the end the app pushes the speak request to the queue and speaks it out loud. The result of running this part of codes is shown below:</p>
<p><img src="/assets/images/TTSExampleAppScreenShot4.png" alt="TTS Example app screenshot4" width="300" height="451" /></p>

<p>If you want to see the full implementation of this example app, you can check out this <a href="https://github.com/zhanpengwang888/TTSExampleApp">Example App</a> in my git repository.</p>

<h2 id="conclusion">Conclusion</h2>
<p>Android Text To Speech is a powerful feature that can allow android apps to talk by generating speech from given texts. It can help people who have difficulty in reading the contents of the app a lot. The main takeaway from this discussion about Androdi TTS feature is that it is not difficult to be incorporated into any existing apps. To incorporate the TTS feature into an android app, we just need to initialize an TextToSpeech instance for a speech engine, define the behaviors of the TTS engine (e.g. through <code class="highlighter-rouge">TextToSpeech.setLanguage()</code>, <code class="highlighter-rouge">setPitch()</code>, <code class="highlighter-rouge">setSpeedRate()</code>, etc.), make the TTS instance either speak the text out loud through <code class="highlighter-rouge">speak()</code> or store the speech as an audio file through <code class="highlighter-rouge">synthesizeToFile()</code>, and finally shut down the TTS engine if it is not used anymore. But remeber that the language you choose to set the TTS engine should match with the texts that you want your app to speak. Moreover, the Text To Speech feature supports a large number of languages across the world and even includes variations of the same language in different regions. It increases an app’s accessibility to a larger pool of users across the world. If you want to know more about Android Text To Speech, you should definitely check out <a href="https://developer.android.com/reference/android/speech/tts/TextToSpeech">this developer documentation</a>.</p>


            <!-- Comments -->
            
<div class="comments">
    <div id="disqus_thread"></div>
    <script>
        /**
         * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
         * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
         */
        /*
         var disqus_config = function () {
         this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
         this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
         };
         */
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//hongyoulingithubio.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>


        </div>

        <div class="col-md-4">
            <h3>Post Directory</h3>
<div id="post-directory-module">
<section class="post-directory">
    <!-- Links that trigger the jumping -->
    <!-- Added by javascript below -->
    <dl></dl>
</section>
</div>

<script type="text/javascript">

    $(document).ready(function(){
        $( "article h2" ).each(function( index ) {
            $(".post-directory dl").append("<dt><a class=\"jumper\" hre=#" +
                    $(this).attr("id")
                    + ">"
                    + $(this).text()
                    + "</a></dt>");

            var children = $(this).nextUntil("h2", "h3")

            children.each(function( index ) {
                $(".post-directory dl").append("<dd><a class=\"jumper\" hre=#" +
                        $(this).attr("id")
                        + ">"
                        + "&nbsp;&nbsp;- " + $(this).text()
                        + "</a></dd>");
            });
        });

        var fixmeTop = $('#post-directory-module').offset().top - 100;       // get initial position of the element

        $(window).scroll(function() {                  // assign scroll event listener

            var currentScroll = $(window).scrollTop(); // get current position

            if (currentScroll >= fixmeTop) {           // apply position: fixed if you
                $('#post-directory-module').css({      // scroll to that element or below it
                    top: '100px',
                    position: 'fixed',
                    width: 'inherit'
                });
            } else {                                   // apply position: static
                $('#post-directory-module').css({      // if you scroll above it
                    position: 'inherit',
                    width: 'inherit'
                });
            }

        });

        $("a.jumper").on("click", function( e ) {

            e.preventDefault();

            $("body, html").animate({
                scrollTop: ($( $(this).attr('hre') ).offset().top - 100)
            }, 600);

        });
    });

</script>
        </div>
        

    </div>

</article>

        </div>

    <footer class="container">

    <div class="site-footer">

        <div class="copyright pull-left">
            <!-- 请不要更改这一行 方便其他人知道模板的来源 谢谢 -->
            <!-- Please keep this line to let others know where this theme comes from. Thank you :D -->
            Power by <a href="https://github.com/DONGChuan/Yummy-Jekyll">Yummy Jekyll </a>
            <div>
                    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
                    <style type="text/css">
                    .fa_custom {
                    color: #ff0000
                    }
                    </style>
                    <body>
                        Adopted with
                        <i class="fa fa-heart fa_custom"></i>
                        by Hongyou Lin
                    </body>
                </div>
        </div>
        <a href="https://github.com/HongyouLin97" target="_blank" aria-label="view source code">
            <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
        </a>

        <div class="pull-right">
            <a href="javascript:window.scrollTo(0,0)" >TOP</a>
        </div>

    </div>

    <!-- Third-Party JS -->
    <script type="text/javascript" src="/bower_components/geopattern/js/geopattern.min.js"></script>

    <!-- My JS -->
    <script type="text/javascript" src="/assets/js/script.js"></script>

    

    
    <!-- Google Analytics -->
    <div style="display:none">
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-123175385-1', 'auto');
            ga('send', 'pageview');

        </script>
    </div>
    

</footer>


    </body>

</html>
